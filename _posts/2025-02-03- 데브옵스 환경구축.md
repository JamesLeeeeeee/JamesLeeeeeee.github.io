---
layout: post
title: devops 환경 구축
categories: kubernetes devops 
description: kubernetes devops 환경 구축
keywords: kubernetes devops jenkins dockerhub
---



# 데브옵스 환경구축
~~~
이 글은 인프런 쿠버네티스 어나더 클래스 자료입니다.
~~~



## CI/CD 서버구축축
```Bash
# Vagrant 폴더 생성
C:\Users\사용자> mkdir cicd
C:\Users\사용자> cd cicd

# Vagrant 스크립트 다운로드
C:\Users\사용자\cicd> curl -O https://raw.githubusercontent.com/k8s-1pro/install/main/ground/cicd-server/vagrant-2.3.4/Vagrantfile

# Rocky Linux Repo 세팅
C:\Users\사용자\cicd> curl -O https://raw.githubusercontent.com/k8s-1pro/install/main/ground/cicd-server/vagrant-2.3.4/rockylinux-repo.json
C:\Users\사용자\cicd> vagrant box add rockylinux-repo.json

# Vagrant Vbguest 및 Disk Plugin 설치 
C:\Users\사용자\cicd> vagrant plugin install vagrant-vbguest vagrant-disksize

# Vagrant 실행
C:\Users\사용자\cicd> vagrant up
```

## jenkins 셋팅
```Bash
[root@cicd-server ~]# cat /var/lib/jenkins/secrets/initialAdminPassword  # 비밀번호 복사

http://192.168.56.20:8080/login  로 들어가서

```

![Image](https://github.com/user-attachments/assets/23e9c3b1-e760-4240-81f3-ac577fb165a8)

![Image](https://github.com/user-attachments/assets/4a3799e7-e1ef-47a9-a283-6ca6be89d1ce)

![Image](https://github.com/user-attachments/assets/a5a035b5-031f-4e6a-bac8-b3ede57797a4)

![Image](https://github.com/user-attachments/assets/1c48fb7c-63e5-4907-a81a-7da29693f0c1)

```Bash
[root@cicd-server ~]# find / -name java | grep java-17-openjdk
/usr/lib/jvm/java-17-openjdk-17.0.7.0.7-3.el8.x86_64/bin/java  // -->> /bin/java 제외하고 복사
```

![Image](https://github.com/user-attachments/assets/93e207ae-d6e3-4e90-9edc-e7499d9dc1d2)

```Bash
# Name : gradle-7.6.1
# GRADLE_HOME : /opt/gradle/gradle-7.6.1
```

![Image](https://github.com/user-attachments/assets/5aa4636e-53e8-4027-b30a-34e2256ada3a)

## docker hub

가입 후에 

## jenkins docker 사용

```Bash
# jeknins가 Docker를 사용할 수 있도록 권한 부여
[root@cicd-server ~]# chmod 666 /var/run/docker.sock
[root@cicd-server ~]# usermod -aG docker jenkins

# Jeknins로 사용자 변경 
[root@cicd-server ~]# su - jenkins -s /bin/bash

# 자신의 Dockerhub로 로그인 하기
[jenkins@cicd-server ~]$ docker login
Username: 
Password: 
```

![Image](https://github.com/user-attachments/assets/ebcfb580-73d5-43f8-a75f-ad097fa020bf)
위와 같이 나온면 성공!

## master node 인증서 복사

```Bash
# 폴더 생성
[jenkins@cicd-server ~]$ mkdir ~/.kube

# Master Node에서 인증서 가져오기
[jenkins@cicd-server ~]$ scp root@192.168.56.30:/root/.kube/config ~/.kube/
```

```Bash
# kubectl 명령어 사용 확인
[jenkins@cicd-server ~]$ kubectl get pods -A
```

![Image](https://github.com/user-attachments/assets/2732fef0-4567-4d23-a352-5a7d9b7b1dce)

ci/cd에서 조회 가능!

## 빌드/배포 파이프라인을 위한 스크립트 작성 및 실행

![Image](https://github.com/user-attachments/assets/76abd9c4-cce6-49a9-919a-6038c0cf2eef)

### gradle build
![Image](https://github.com/user-attachments/assets/e891c44f-df28-4bcb-baa5-2d7c7b6ead9a)

![Image](https://github.com/user-attachments/assets/dbb3e1c0-6b16-44ab-be67-997b6f203a36)

![Image](https://github.com/user-attachments/assets/0e8a23f4-d850-424a-ae10-9ce48ba399bc)

![Image](https://github.com/user-attachments/assets/37473d42-864f-4e51-af52-84ce88f5fe9b)

![Image](https://github.com/user-attachments/assets/c137995d-f625-4516-990d-bb918f55b76b)

![Image](https://github.com/user-attachments/assets/329e088f-4945-4cdc-9eb1-de7a54199ccd)
jar 파일 생성 확인


### docker 컨테이너 빌드
![Image](https://github.com/user-attachments/assets/4211391d-54ac-4cc2-ac1d-36c91ed9b860)

![Image](https://github.com/user-attachments/assets/07f66e34-3637-426e-8cec-62f993270b62)

![Image](https://github.com/user-attachments/assets/4e7d3677-5529-414b-8191-119032212c10)

![Image](https://github.com/user-attachments/assets/b1b8aff0-e6e2-4b5f-b894-85e13f8ad69c)

![Image](https://github.com/user-attachments/assets/8010db2e-2c7c-405f-a51b-c645632dffc5)

![Image](https://github.com/user-attachments/assets/49bbb968-e96e-49e0-85f9-6c6bffe012d7)

![Image](https://github.com/user-attachments/assets/92211d21-c841-44e3-b6db-18b441a2009e)

![Image](https://github.com/user-attachments/assets/4759179e-76dc-456e-8008-d084bbd52fb4)

```
Dockerfile 내용  확인 가능

expose: docker container 포트 오픈
workdir: container 시작 폴더
```


### 배포하기 - kubectl deploy

![Image](https://github.com/user-attachments/assets/c95879ff-eb75-4a0b-b881-81c8c19e452e)

![Image](https://github.com/user-attachments/assets/f95e06d6-bc78-463c-abe0-d005a9c8f0bc)

![Image](https://github.com/user-attachments/assets/b1ce626f-4d25-46cc-a807-a40522e23107)

![Image](https://github.com/user-attachments/assets/135e3a0b-416e-4814-8fef-ce850b5bc268)
~~~
kubectl apply -f ./2121/deploy/k8s/namespace.yaml
kubectl apply -f ./2121/deploy/k8s/pv.yaml
kubectl apply -f ./2121/deploy/k8s/pvc.yaml
kubectl apply -f ./2121/deploy/k8s/configmap.yaml
kubectl apply -f ./2121/deploy/k8s/secret.yaml
kubectl apply -f ./2121/deploy/k8s/service.yaml
kubectl apply -f ./2121/deploy/k8s/hpa.yaml
kubectl apply -f ./2121/deploy/k8s/deployment.yaml
~~~

![Image](https://github.com/user-attachments/assets/72842ae4-24f3-4db8-9fa6-30ee06087658)

![Image](https://github.com/user-attachments/assets/b54fca0d-b875-4f87-8275-908f60c6582c)

