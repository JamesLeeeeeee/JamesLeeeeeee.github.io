---
layout: post
title: 배포전략
categories: kubernetes devops 
description: kubernetes devops 배포전략
keywords: kubernetes devops jenkins dockerhub
---



# 데브옵스 환경구축
~~~
이 글은 인프런 쿠버네티스 어나더 클래스 자료입니다.
~~~



## CI/CD 파이프라인을 구성할 때 고려해야 하는 요소
![Image](https://github.com/user-attachments/assets/54e3fac0-df43-4963-8484-36af493ba945")

* 기능보다 담당자 별로 구성을 나누는게 효율적
* ArgoCD 패포툴을 이용해서 배포 가능
* 운영관계를 1대 다 또는 1대 1로 구성 가능 (1대 1 방식을 많이 씀)
    * 하나만 관리할지, 장애 영향을 줄일지 결정
* CI/CD 툴
    * 온라인 git actions
    * 오프라인 젠킨스, 젠킨스x, tekton
온라인/오프라인을 고려하고 레퍼런스가 많은걸 우선 고려

* 도커 컨테이너
    * 도커가 무거울 때는 다른 컨테이너툴 사용 고려 가능

## 배포 전략을 세울 때 고려해야 하는 요소
![Image](https://github.com/user-attachments/assets/0b1c7a90-8f67-4ec5-a31a-468d97a7b18f)

* recreate
    - v1을 정지한 후 v2 pod 배포
    - 서비스 중단
    - 데이터 베이스 변경 시 사용해야 함
* rollingUpdate
    - 기존 정지 후 v2 배포
    - 서비스 중단은 없음
* blue/green
    - v2가 준비 되면 v1 정지 후 v1 삭제
    - 과도한 트래픽은 v2변환에 지장을 주게 될 수도 있음
    - 운영에서만 db를 연결 할 경우 사용
* canary
    - 가중치를 변경해가며 v2로 천천히 배포
    - 트래픽 할당을 조절하며 배포할 수 있다

![Image](https://github.com/user-attachments/assets/6ddbc4db-9d4a-4239-8f70-b8546ecd2628")

* 단계별로 진행해서 에러를 예측하고 줄임
* 젠킨스 UI로 진행 단계 파악 쉬움
* yaml 파일로 관리하면 시작은 어려우나 형상관리가 용이함
* argoCD는 저장소와 인프라간의 형상관리를 싱크를 맞추며 관리함
* blue/green과 canary를 argoCD에서 가능
